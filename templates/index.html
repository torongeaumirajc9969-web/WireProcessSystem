<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>漆包线生产工艺管理系统</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.0/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css">
    <style>
        body { background-color: #f8f9fa; }
        .card { border: none; box-shadow: 0 4px 6px rgba(0,0,0,0.1); }
        .nav-tabs .nav-link.active { background-color: #fff; border-bottom-color: #fff; font-weight: bold; color: #495057; }
        .table-hover tbody tr:hover { background-color: #f1f1f1; }
        .btn-sm { padding: 0.25rem 0.5rem; font-size: 0.875rem; }
    </style>
</head>
<body>

    <nav class="navbar navbar-expand-lg navbar-dark bg-dark mb-4">
        <div class="container">
            <a class="navbar-brand" href="#"><i class="fas fa-industry mr-2"></i>漆包线生产工艺管理系统</a>
            <span class="navbar-text text-white-50"><small>Ver 2.0 | 完整版</small></span>
        </div>
    </nav>

    <div class="container">
        <ul class="nav nav-tabs mb-4" id="myTab" role="tablist">
            <li class="nav-item">
                <a class="nav-link active" id="process-tab" data-toggle="tab" href="#process" role="tab"><i class="fas fa-clipboard-check text-primary mr-1"></i> 生产工艺记录</a>
            </li>
            <li class="nav-item">
                <a class="nav-link" id="problem-tab" data-toggle="tab" href="#problem" role="tab"><i class="fas fa-exclamation-triangle text-danger mr-1"></i> 异常问题登记</a>
            </li>
        </ul>

        <div class="tab-content" id="myTabContent">

            <div class="tab-pane fade show active" id="process" role="tabpanel">
                <div class="card mb-4">
                    <div class="card-header bg-primary text-white"><i class="fas fa-plus-circle"></i> 新增工艺参数</div>
                    <div class="card-body">
                        <form action="/" method="POST">
                            <div class="form-row">
                                <div class="form-group col-md-3">
                                    <label>机台编号</label>
                                    <select class="form-control" name="machine_model" required>
                                        <option value="" disabled selected>请选择...</option>
                                        {% for i in range(1, 8) %}<option value="{{ i }}号机">{{ i }}号机</option>{% endfor %}
                                    </select>
                                </div>
                                <div class="form-group col-md-3">
                                    <label>产品型号</label>
                                    <input type="text" class="form-control" name="product_type" placeholder="如: UEW/155" required>
                                </div>
                                <div class="form-group col-md-3">
                                    <label>规格 (mm)</label>
                                    <input type="text" class="form-control" name="wire_spec" placeholder="如: 0.050" required>
                                </div>
                                <div class="form-group col-md-3">
                                    <label>线速 (DV值)</label>
                                    <input type="text" class="form-control" name="wire_speed" placeholder="可选填">
                                </div>
                            </div>
                            <button type="submit" class="btn btn-primary px-5"><i class="fas fa-save"></i> 保存工艺</button>
                        </form>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header bg-white d-flex justify-content-between align-items-center">
                        <span><i class="fas fa-list"></i> 历史工艺列表</span>
                        <a href="/export_all" class="btn btn-success btn-sm"><i class="fas fa-file-excel"></i> 导出完整生产日志</a>
                    </div>
                    <div class="table-responsive">
                        <table class="table table-hover mb-0">
                            <thead class="thead-light">
                                <tr>
                                    <th>时间</th>
                                    <th>机台</th>
                                    <th>产品型号</th>
                                    <th>规格</th>
                                    <th>线速</th>
                                    <th style="width: 80px;">操作</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for record in records %}
                                <tr>
                                    <td class="text-muted">{{ record.create_time.strftime('%Y-%m-%d %H:%M') }}</td>
                                    <td><span class="badge badge-info">{{ record.machine_model }}</span></td>
                                    <td><strong>{{ record.product_type }}</strong></td>
                                    <td>{{ record.wire_spec }}</td>
                                    <td>{{ record.wire_speed }}</td>
                                    <td>
                                        <a href="/delete_process/{{ record.id }}" class="btn btn-outline-danger btn-sm" onclick="return confirm('确认删除？')"><i class="fas fa-trash-alt"></i></a>
                                    </td>
                                </tr>
                                {% else %}
                                <tr><td colspan="6" class="text-center py-4 text-muted">暂无数据</td></tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <div class="tab-pane fade" id="problem" role="tabpanel">
                <div class="row">
                    <div class="col-md-4">
                        <div class="card border-danger mb-3">
                            <div class="card-header bg-danger text-white"><i class="fas fa-fire"></i> 登记异常</div>
                            <div class="card-body">
                                <form action="/add_problem" method="POST">
                                    <div class="form-group">
                                        <label>发生机台</label>
                                        <select class="form-control" name="machine_model" required>
                                            <option value="" disabled selected>请选择...</option>
                                            {% for i in range(1, 8) %}<option value="{{ i }}号机">{{ i }}号机</option>{% endfor %}
                                        </select>
                                    </div>
                                    <div class="form-row">
                                        <div class="form-group col-md-6">
                                            <label>产品型号</label>
                                            <input type="text" class="form-control" name="product_type" placeholder="如: UEW" required>
                                        </div>
                                        <div class="form-group col-md-6">
                                            <label>规格</label>
                                            <input type="text" class="form-control" name="wire_spec" placeholder="如: 0.05" required>
                                        </div>
                                    </div>

                                    <div class="form-group">
                                        <label>问题描述</label>
                                        <textarea class="form-control" name="issue_desc" rows="3" required></textarea>
                                    </div>
                                    <div class="form-group">
                                        <label>解决措施</label>
                                        <textarea class="form-control" name="solution" rows="3"></textarea>
                                    </div>
                                    <button type="submit" class="btn btn-danger btn-block"><i class="fas fa-exclamation-circle"></i> 提交异常记录</button>
                                </form>
                            </div>
                        </div>
                    </div>

                    <div class="col-md-8">
                        <div class="card">
                            <div class="card-header bg-white text-danger"><i class="fas fa-history"></i> 近期异常记录</div>
                            <div class="table-responsive">
                                <table class="table table-striped mb-0">
                                    <thead>
                                        <tr>
                                            <th>时间</th>
                                            <th>机台</th>
                                            <th>型号/规格</th>
                                            <th>问题描述</th>
                                            <th>解决措施</th>
                                            <th style="width: 80px;">操作</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        {% for problem in problems %}
                                        <tr>
                                            <td class="small">{{ problem.create_time.strftime('%m-%d %H:%M') }}</td>
                                            <td><span class="badge badge-danger">{{ problem.machine_model }}</span></td>
                                            <td class="small">
                                                <div>{{ problem.product_type }}</div>
                                                <div class="text-muted">{{ problem.wire_spec }}</div>
                                            </td>
                                            <td class="text-danger">{{ problem.issue_desc }}</td>
                                            <td class="text-success">{{ problem.solution }}</td>
                                            <td>
                                                <a href="/delete_problem/{{ problem.id }}" class="btn btn-outline-secondary btn-sm" onclick="return confirm('确认删除？')"><i class="fas fa-times"></i></a>
                                            </td>
                                        </tr>
                                        {% else %}
                                        <tr><td colspan="6" class="text-center py-4 text-muted">暂无异常记录</td></tr>
                                        {% endfor %}
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <footer class="text-center mt-5 mb-3 text-muted"><small>&copy; 2024 漆包线生产部</small></footer>
    </div>

    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>